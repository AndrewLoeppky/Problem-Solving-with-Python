version: '3.8'

services:
  webserver:
    build:
      context: .
      dockerfile: docker_webserver/Dockerfile
    image: phaustin/webserver_intropy
    container_name: webserver_intropy
    ports:
      - "${TEXT_PORT}:80"
    volumes:
      - type: bind
        source: ./notebooks/_build/html
        target: /usr/local/apache2/htdocs
      - "/var/run/docker.sock:/var/run/docker.sock"
      - jupyterhub_data:/srv/jupyterhub
    networks:
      - dask_net

  datascience-notebook:
      image:    jupyter/minimal-notebook
      volumes:
        - ${LOCAL_WORKING_DIR}:/home/jovyan/work
        - ${LOCAL_DATASETS}:/home/jovyan/work/datasets
        - ${LOCAL_MODULES}:/home/jovyan/work/modules
        - ${LOCAL_SSL_CERTS}:/etc/ssl/notebook
      ports:
        - ${NB_PORT}:8888
      networks:
        - dask_net
      container_name:   jupyter_notebook
      command: "start-notebook.sh \
         --NotebookApp.password=${ACCESS_TOKEN}"

# the actual name will be <directory_name>_<network_name>
networks:
    dask_net:
      driver: bridge

volumes:
  jupyterhub_data:

